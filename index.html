<html>
    <head>
        <link href="http://code.jquery.com/ui/jquery-ui-git.css" type="text/css" rel="stylesheet">
        <script type="text/javascript" src="./require.js"></script>
        <style>
            body{
                font-size: 12px;
            }
            table {
                font-size: 11px;
            }
            table th.sortable.asc:after {
                content: "^"
            }
            table th.sortable.desc:after {
                content: "v"
            }
            table tr.selected {
                background-color: #ccffcc;
            }
            .feedback {
                float: right;
            }
            .gridHolder {
                
            }
        </style>
        <script>
        require.config({
            enforceDefine: true,
            paths: {
                jquery: "http://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min",
                json2: "http://cdnjs.cloudflare.com/ajax/libs/json2/20110223/json2",
                backbone: "http://cdnjs.cloudflare.com/ajax/libs/backbone.js/0.9.2/backbone-min",
                underscore: "http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min",
                text: 'requirejs_text',
                jqueryUi: 'http://code.jquery.com/ui/jquery-ui-git'
            },
            shim: {
                json2: {
                    exports: 'JSON'
                },
                underscore: {
                    exports: '_'
                },
                backbone: {
                    deps: ['underscore', 'jquery', 'json2'],
                    exports: 'Backbone'
                },
                jqueryUi: {
                    deps: ['jquery'],
                    exports: '$.ui'
                }
            }
        });
        </script>
        
        <script>
            require(['./backbone-grid', 'backbone', 'jquery', 'text!testdata.json', 'underscore', 'jqueryUi'], function (Grid, backbone, $, testdata, _) {
                $(document).ready(function () {
                    $( "#sample" ).tabs();
                    $("#sample").delegate('ul a', 'click', function () {
                        window.location.hash = $(this).attr('href')
                    })
                    collection = new Backbone.Collection(JSON.parse(testdata));
                    console.log(collection.length);
                    var noTemplateGrid = new Grid({
                        collection: collection,
                        el: $("#notemplate"),
                        columns: [
                            'name', 
                            'location',
                            'startDate',
                            'endDate'
                        ]
                    });
                    noTemplateGrid.render();
                    
                    var _template = _.template([
                        "<tr>",
                        "<td><%- name %></td>",
                        "<td><%- location %></td>",
                        "<td><%- new Date(startDate).toUTCString() %></td>",
                        "<td><%- new Date(endDate).toUTCString() %></td>",
                        "</tr>"
                    ].join("\n"));
                    var _TemplateGrid = new Grid({
                        collection: collection,
                        el: $("#_template"),
                        rowTemplate: _template
                    });
                    _TemplateGrid.render();
                    
                    $("#removeFirst").click(function () {
                        collection.remove(collection.at(0));
                    });
                    
                    require(['behaviors/Sortable'], function (Sortable) {
                        var SortableGrid = new Grid({
                            behaviors: [
                                {
                                    behavior: Sortable, 
                                    options: {
                                        defaultSortSelector: 'name'
                                    }
                                }
                            ],
                            collection: collection,
                            el: $("#sortablegrid"),
                            rowTemplate: _template
                        });
                        SortableGrid.render();
                    });
                    
                    require(['behaviors/Selectable'], function (Selectable) {
                        SelectableGrid = new Grid({
                            behaviors: [
                                {
                                    behavior: Selectable,
                                    options: {
                                        selection: 'multiple'
                                    }
                                }
                            ],
                            collection: collection,
                            el: $("#selectablegrid"),
                            rowTemplate: _template
                        });
                        SelectableGrid.render();
                        SelectableGrid.on('selectionChange', function (modelsSelected) {
                            $("#selectablegrid_feedback").empty();
                            _.each(modelsSelected, function (model) {
                                var $data = $("<div>");
                                $data.text(model.get('name'));
                                $("#selectablegrid_feedback").append($data)
                            })
                        })
                    });
                });
            })
        </script>
        
    </head>
    <body>
        <div class="controller">
            <button id="removeFirst">Remove first model in collection</button>
        </div>
        <div id="sample">
            <ul>
                    <li><a href="#column">Column Definition Only</a></li>
                    <li><a href="#template">Row Template</a></li>
                    <li><a href="#sortable">Sortable behavior</a></li>
                    <li><a href="#selectable">Selectable behavior</a></li>
            </ul>
            <div id="column">
                <h2>Column Definition Only</h2>
                <div id="notemplate">
                    <table></table>
                </div>
            </div>
            <div id="template">
                <h2>Row Template Passed</h2>
                <div id="_template">
                    <table></table>
                </div>
            </div>
            <div id="sortable">
                <h2>Sortable behavior</h2>
                <div id="sortablegrid" class="gridHolder">
                    <table>
                        <thead>
                            <tr>
                                <th class="sortable name" data-column="name">Name</th>
                                <th class="sortable location" data-column="location">Location</th>
                                <th class="sortable startDate" data-column="startDate">Start Date</th>
                                <th class="sortable endDate" data-column="endDate">End Date</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
            <div id="selectable">
                <h2>Selectable behavior</h2>
                <div id="selectablegrid_feedback" class="feedback">
                </div>
                <div id="selectablegrid" class="gridHolder">
                    <table>
                        <thead>
                            <tr>
                                <th class="sortable name" data-column="name">Name</th>
                                <th class="sortable location" data-column="location">Location</th>
                                <th class="sortable startDate" data-column="startDate">Start Date</th>
                                <th class="sortable endDate" data-column="endDate">End Date</th>
                            </tr>
                        </thead>
                    </table>
                </div>
                
            </div>
        </div>
    </body>
</html>