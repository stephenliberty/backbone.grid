<html>
    <head>
        <script type="text/javascript" src="./require.js"></script>
        <style>
            body{
                font-size: 12px;
            }
            table {
                font-size: 11px;
            }
            table th.sortable.asc:after {
                content: "^"
            }
            table th.sortable.desc:after {
                content: "v"
            }
            
        </style>
        <script>
        require.config({
            enforceDefine: true,
            paths: {
                jquery: "http://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min",
                json2: "http://cdnjs.cloudflare.com/ajax/libs/json2/20110223/json2",
                backbone: "http://cdnjs.cloudflare.com/ajax/libs/backbone.js/0.9.2/backbone-min",
                underscore: "http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min",
                text: 'requirejs_text'
            },
            shim: {
                json2: {
                    exports: 'JSON'
                },
                underscore: {
                    exports: '_'
                },
                backbone: {
                    deps: ['underscore', 'jquery', 'json2'],
                    exports: 'Backbone'
                }
            }
        });
        </script>
        
        <script>
            require(['./backbone-grid', 'backbone', 'jquery', 'text!testdata.json', 'underscore'], function (Grid, backbone, $, testdata, _) {
                $(document).ready(function () {
                    
                    collection = new Backbone.Collection(JSON.parse(testdata));
                    console.log(collection.length);
                    var noTemplateGrid = new Grid({
                        collection: collection,
                        el: $("#notemplate"),
                        columns: [
                            'name', 
                            'location',
                            'startDate',
                            'endDate'
                        ]
                    });
                    noTemplateGrid.render();
                    
                    var _template = _.template([
                        "<tr>",
                        "<td><%- name %></td>",
                        "<td><%- location %></td>",
                        "<td><%- new Date(startDate).toUTCString() %></td>",
                        "<td><%- new Date(endDate).toUTCString() %></td>",
                        "</tr>"
                    ].join("\n"));
                    var _TemplateGrid = new Grid({
                        collection: collection,
                        el: $("#_template"),
                        rowTemplate: _template
                    });
                    _TemplateGrid.render();
                    
                    $("#removeFirst").click(function () {
                        collection.remove(collection.at(0));
                    });
                    
                    require(['behaviors/Sortable'], function (Sortable) {
                        var SortableGrid = new Grid({
                            behaviors: [
                                {
                                    behavior: Sortable, 
                                    options: {
                                        defaultSortSelector: 'name'
                                    }
                                }
                            ],
                            collection: collection,
                            el: $("#sortable"),
                            rowTemplate: _template
                        });
                        SortableGrid.render();
                        SortableGrid.on('rowClicked', function (row, model) {
                            alert("Row Clicked: for model cid:" + model.cid)
                        })
                    });
                    _TemplateGrid.on('rowClicked', function (row, model) {
                        alert("Row Clicked: for model cid:" + model.cid)
                    })
                    noTemplateGrid.on('rowClicked', function (row, model) {
                        alert("Row Clicked: for model cid:" + model.cid)
                    })
                });
            })
        </script>
        
    </head>
    <body>
        <div class="controller">
            <button id="removeFirst">Remove first model in collection</button>
        </div>
        <div class="sample">
            <h2>Column Definition Only</h2>
            <div id="notemplate">
                <table></table>
            </div>
            <h2>Row Template Passed</h2>
            <div id="_template">
                <table></table>
            </div>
            <h2>Sortable behavior</h2>
            <div id="sortable">
                <table>
                    <thead>
                        <tr>
                            <th class="sortable name" data-column="name">Name</th>
                            <th class="sortable location" data-column="location">Location</th>
                            <th class="sortable startDate" data-column="startDate">Start Date</th>
                            <th class="sortable endDate" data-column="endDate">End Date</th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
    </body>
</html>